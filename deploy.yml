- name: Install and run Docker container 
  hosts: webservers 
  become: yes 
  tasks: 
   - name: Install Docker 
     apt: 
       update_cache: yes 
       name: docker.io 

   - name: Install pip 
     apt: 
       name: python3-pip 
 
   - name: Install docker module 
     pip: 
       name: docker  

   - name: Login to Docker Hub 
     docker_login: 
       username: "{{ DOCKERHUB_USERNAME }}" 
       password: "{{ DOCKERHUB_PASSWORD }}" 

   - name: Pull Docker image 
     docker_image: 
       name: kausthubhbhosekar/docker-fastapi-test:latest 
       source: pull  

   - name: Run Docker container 
     docker_container: 
       name: my-container-ansible-deploy 
       image: kausthubhbhosekar/docker-fastapi-test:latest 
       state: started 
       ports: 
         - "80:8000"          

     register: container_info 

 

 

   - name: Fetch container logs 

     command: "docker logs {{ container_info.container.Id }}" 

     register: container_logs 

 

   - name: Display container logs 

     debug: 

       var: container_logs.stdout_lines 
